@model DraftOrderModel

<!-- Button trigger modal -->
<div class="col-md-12" style="display:flex;justify-content:right">
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#customProductPopUp" style="background:unset;border:0;" data-backdrop="static" onclick="setCustomItemDefaultsOnOpen()">
        <span style="color:#2c6ecb"> Add custom product</span>

    </button>
</div>

<!-- Modal -->
<div class="modal fade" id="customProductPopUp" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document" style="min-width:38rem">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalCenterTitle">Add custom product</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div style="column-gap:1rem;margin-bottom:10px;
                            display: grid;
                            grid-template-areas: 'name price quantity';
                            grid-template-columns: .5fr .25fr .25fr;">
                    <div style="grid-area: name">
                        <div style="box-sizing:border-box">
                            <div style="word-wrap: break-word;
                                        align-items: baseline;
                                        display: flex;
                                        flex-wrap: wrap;
                                        justify-content: space-between;
                                        overflow-wrap: break-word;
                                        word-break: break-word;">
                                <div>
                                    <label>
                                        Item Name
                                    </label>
                                </div>

                            </div>
                            <div style="flex:1 1 auto;display:flex;z-index:20;line-height:1.85rem;font-size:1.05rem">
                                <div style="display:flex;flex-grow:1;">
                                    <input id="itemName" autocomplete="off" type="text" style="width:100%;padding-left:10px" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="grid-area: price;">
                        <div style="box-sizing:border-box">
                            <div style="word-wrap: break-word;
                                        align-items: baseline;
                                        display: flex;
                                        flex-wrap: wrap;
                                        justify-content: space-between;
                                        overflow-wrap: break-word;
                                        word-break: break-word;">
                                <div>
                                    <label>
                                        Price
                                    </label>
                                </div>

                            </div>
                            <div style="flex:1 1 auto;display:flex;z-index:20;line-height:1.85rem;font-size:1.05rem">
                                <div style="display:flex;flex-grow:1;position:relative;margin-left:-8px">
                                    <span style="position:relative;left:18px;display:inline-flex;align-items:center">$</span>
                                    <input id="itemPrice" class="allow_decimal" placeholder="0.00" autocomplete="off" type="text" style="width:100%;padding-left:20px" onkeyup="" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="grid-area: quantity">
                        <div style="box-sizing:border-box">
                            <div style="word-wrap: break-word;
                                        align-items: baseline;
                                        display: flex;
                                        flex-wrap: wrap;
                                        justify-content: space-between;
                                        overflow-wrap: break-word;
                                        word-break: break-word;">
                                <div>
                                    <label>
                                        Quantity
                                    </label>
                                </div>

                            </div>
                            <div style="flex:1 1 auto;display:flex;z-index:20;line-height:1.85rem;font-size:1.05rem">
                                <div style="display:flex;flex-grow:1;">
                                    <input id="itemQuantity" autocomplete="off" type="number" style="width:100%;padding-left:10px" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="column-gap:1rem;
                            display: grid;
                            grid-template-areas: 'length width height weight';
                            grid-template-columns: .25fr .25fr .25fr .25fr;">
                    <div style="grid-area: length">
                        <div style="box-sizing:border-box">
                            <div style="word-wrap: break-word;
                                        align-items: baseline;
                                        display: flex;
                                        flex-wrap: wrap;
                                        justify-content: space-between;
                                        overflow-wrap: break-word;
                                        word-break: break-word;">
                                <div>
                                    <label>
                                        Length
                                    </label>
                                </div>

                            </div>
                            <div style="flex:1 1 auto;display:flex;z-index:20;line-height:1.85rem;font-size:1.05rem">
                                <div style="display:flex;flex-grow:1;">
                                    <input id="itemLength" autocomplete="off" type="number" style="width:100%;padding-left:10px" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="grid-area: width;">
                        <div style="box-sizing:border-box">
                            <div style="word-wrap: break-word;
                                        align-items: baseline;
                                        display: flex;
                                        flex-wrap: wrap;
                                        justify-content: space-between;
                                        overflow-wrap: break-word;
                                        word-break: break-word;">
                                <div>
                                    <label>
                                        Width
                                    </label>
                                </div>

                            </div>
                            <div style="flex:1 1 auto;display:flex;z-index:20;line-height:1.85rem;font-size:1.05rem">
                                <div style="display:flex;flex-grow:1;">
                                    <input id="itemWidth" autocomplete="off" type="number" style="width:100%;padding-left:10px" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="grid-area: height">
                        <div style="box-sizing:border-box">
                            <div style="word-wrap: break-word;
                                        align-items: baseline;
                                        display: flex;
                                        flex-wrap: wrap;
                                        justify-content: space-between;
                                        overflow-wrap: break-word;
                                        word-break: break-word;">
                                <div>
                                    <label>
                                        Height
                                    </label>
                                </div>

                            </div>
                            <div style="flex:1 1 auto;display:flex;z-index:20;line-height:1.85rem;font-size:1.05rem">
                                <div style="display:flex;flex-grow:1;">
                                    <input id="itemHeight" autocomplete="off" type="number" style="width:100%;padding-left:10px" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="grid-area: weight">
                        <div style="box-sizing:border-box">
                            <div style="word-wrap: break-word;
                                        align-items: baseline;
                                        display: flex;
                                        flex-wrap: wrap;
                                        justify-content: space-between;
                                        overflow-wrap: break-word;
                                        word-break: break-word;">
                                <div>
                                    <label>
                                        Weight
                                    </label>
                                </div>

                            </div>
                            <div style="flex:1 1 auto;display:flex;z-index:20;line-height:1.85rem;font-size:1.05rem">
                                <div style="display:flex;flex-grow:1;">
                                    <input id="itemWeight" autocomplete="off" type="number" style="width:100%;padding-left:10px" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btnCancel" type="button" class="btn btn-secondary" data-dismiss="modal" >Cancel</button>
                <button type="button" class="btn btn-primary" onclick="addCustomProduct()">Add product</button>
            </div>
        </div>
    </div>
</div>
<br />

<script>
    function setCustomItemDefaultsOnOpen() {
        $(itemName).val("");
        $(itemPrice).val("");
        $(itemQuantity).val("1");
    }
    $(".allow_decimal").on("input", function (evt) {
        var self = $(this);
        self.val(self.val().replace(/[^0-9\.]/g, ''));
        if ((evt.which != 46 || self.val().indexOf('.') != -1) && (evt.which < 48 || evt.which > 57)) {
            evt.preventDefault();
        }
    });

    function addCustomProduct() {
        var postData = {
            itemName: $("#itemName").val(),
            draftOrderId: @Model.Id,
            itemPrice: $("#itemPrice").val(),
            itemQuantity: $("#itemQuantity").val(),
            itemLength: $("#itemLength").val(),
            itemWidth: $("#itemWidth").val(),
            itemHeight: $("#itemHeight").val(),
            itemWeight: $("#itemWeight").val()

        };
        addAntiForgeryToken(postData);
        $.ajax({
            cache: false,
            type: "POST",
            url: "@(Url.Action("AddCustomProduct", "Order"))",
            data: postData,
            traditional: true,

            error: function (jqXHR, textStatus, errorThrown) {
                console.log(errorThrown);
            },
            success: function (data) {
                //console.log(data);
                
                $("#productPanel").html(data);
                if (typeof updateDraftPricing === "function") {
                    updateDraftPricing(draftOrderId)
                }
                
                $('.modal-backdrop').remove();
            }
        });

        return false;
    }
</script>